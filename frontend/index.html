<!doctype html>
<html>
  <head>
    <meta charset='UTF-8'/>
    <meta name='viewport' content='width=device-width,initial-scale=1'/>
    <title>FinSentinel Terminal</title>
    <style>
      body{background:#070b12;color:#eaf1ff;font-family:Inter,Arial,sans-serif;max-width:980px;margin:24px auto;padding:0 16px}
      .card{border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:16px;margin-top:12px;background:#0c1220}
      input,button,select{padding:8px 10px;border-radius:8px;border:1px solid #24324a;background:#0f182c;color:#eaf1ff}
      button{cursor:pointer;margin-right:8px}
      pre{white-space:pre-wrap}
      .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#13243b;border:1px solid #2d4565;font-size:12px;color:#b8d6ff;margin-right:6px}
      .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
      .metric{border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px;background:#0f1729}
      .label{font-size:12px;color:#9cc2ff}
      .value{margin-top:6px;font-size:16px;font-weight:600}
    </style>
  </head>
  <body>
    <h1>FinSentinel â€” Finance Intelligence Copilot</h1>
    <p>
      <span class="badge">Finance Track</span>
      <span class="badge">Deep Learning</span>
      <span class="badge">Microservices</span>
    </p>

    <div class="card">
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <label>Demo case:</label>
        <select id="caseSel"></select>
        <button onclick="loadCase()">Load Case</button>
      </div>
      <div style="margin-top:10px">
        <label>Input features (comma-separated): </label>
        <input id="f" value="0.1,0.4,0.2,0.3,0.8,0.2,0.5,0.9" size="52" />
      </div>
      <div style="margin-top:10px">
        <button onclick="runInfer()">Run Inference</button>
        <button onclick="runSimulate()">Run Simulated Case</button>
      </div>
      <div style="margin-top:10px">
        <span id="be" class="badge">Backend: ...</span>
        <span id="ml" class="badge">ML: ...</span>
      </div>
    </div>

    <div class="card">
      <h3>Result</h3>
      <div class="grid">
        <div class="metric"><div class="label">Risk Score</div><div class="value" id="risk">-</div></div>
        <div class="metric"><div class="label">Label</div><div class="value" id="label">-</div></div>
        <div class="metric"><div class="label">Confidence</div><div class="value" id="conf">-</div></div>
        <div class="metric"><div class="label">Recommendation</div><div class="value" id="rec">-</div></div>
      </div>
      <div class="metric" style="margin-top:10px"><div class="label">Decision Reason</div><div class="value" id="reason">-</div></div>
      <div class="metric" style="margin-top:10px"><div class="label">Timestamp</div><div class="value" id="ts">-</div></div>
    </div>

    <div class="card">
      <h3>Raw Output</h3>
      <pre id="out">(waiting)</pre>
    </div>

    <script>
      const out=document.getElementById('out');
      let demoCases=[];

      function setStatus(el, ok, text){
        el.textContent=text;
        el.style.borderColor = ok ? '#2f8f62' : '#8f3b3b';
        el.style.background = ok ? '#103025' : '#2e1818';
      }

      async function refreshHealth(){
        const be=document.getElementById('be');
        const ml=document.getElementById('ml');
        try {
          const rb = await fetch('http://localhost:4000/health');
          setStatus(be, rb.ok, rb.ok ? 'Backend: OK' : 'Backend: FAIL');
        } catch { setStatus(be,false,'Backend: DOWN'); }

        try {
          const rm = await fetch('http://localhost:4000/api/model-info');
          setStatus(ml, rm.ok, rm.ok ? 'ML: OK' : 'ML: FAIL');
        } catch { setStatus(ml,false,'ML: DOWN'); }
      }

      async function loadDemoCases(){
        const sel=document.getElementById('caseSel');
        sel.innerHTML='';
        try{
          const r=await fetch('http://localhost:4000/api/demo-cases');
          const d=await r.json();
          demoCases=(d.cases||[]);
          for(const c of demoCases){
            const opt=document.createElement('option');
            opt.value=c.name;
            opt.textContent=c.name;
            sel.appendChild(opt);
          }
        }catch(e){
          const opt=document.createElement('option');
          opt.textContent='(failed to load cases)';
          sel.appendChild(opt);
        }
      }

      function loadCase(){
        const sel=document.getElementById('caseSel');
        const target=demoCases.find(x=>x.name===sel.value);
        if(!target) return;
        document.getElementById('f').value=target.features.join(',');
      }

      function render(d){
        document.getElementById('risk').textContent = d.risk_score ?? '-';
        document.getElementById('label').textContent = d.label ?? '-';
        document.getElementById('conf').textContent = d.confidence ?? '-';
        document.getElementById('rec').textContent = d.recommendation ?? '-';
        document.getElementById('reason').textContent = d.decision_reason ?? '-';
        document.getElementById('ts').textContent = d.timestamp ?? '-';
      }

      async function runInfer(){
        const arr=(document.getElementById('f').value||'').split(',').map(x=>Number(x.trim())).filter(x=>!Number.isNaN(x));
        out.textContent='running /api/infer ...';
        try{
          const r=await fetch('http://localhost:4000/api/infer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({features:arr})});
          const d=await r.json();
          out.textContent=JSON.stringify(d,null,2);
          if (d.ok) render(d);
        }catch(e){ out.textContent='error: '+e; }
      }

      async function runSimulate(){
        out.textContent='running /api/simulate ...';
        try{
          const r=await fetch('http://localhost:4000/api/simulate');
          const d=await r.json();
          out.textContent=JSON.stringify(d,null,2);
          if (d.ok) render(d);
        }catch(e){ out.textContent='error: '+e; }
      }

      (async function init(){
        await loadDemoCases();
        await refreshHealth();
      })();
    </script>
  </body>
</html>
